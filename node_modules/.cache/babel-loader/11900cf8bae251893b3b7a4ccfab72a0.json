{"ast":null,"code":"function initIDB(dbName, dbVersion, objectStoreNames) {\n  return new Promise((resolve, reject) => {\n    // dbName will be the DB name, storeName will be the store name.\n    if (!('indexedDB' in window)) {\n      console.warn(\"This browser doesn't support IndexedDB\");\n      return;\n    } // create or open IndexedDB\n\n\n    let request = window.indexedDB.open(dbName, dbVersion); // handle errors\n\n    request.onerror = function (event) {\n      console.error(\"IndexedDB Error: \", request.error);\n      reject(\"Failed to open database\");\n    }; // handle db upgrades\n\n\n    request.onupgradeneeded = function (event) {\n      // save the IDBDatabase interface\n      let db = event.target.result;\n      let successCount = 0; // Create an objectStore for the database\n\n      objectStoreNames.forEach((name, index) => {\n        updgradeDB(db, name).then(() => {\n          successCount++;\n        }).catch(message => {\n          console.error(message);\n        });\n\n        if (index + 1 === objectStoreNames.length) {\n          resolve(\"Database access granted\");\n        } else {\n          reject(\"Database access rejected\");\n        }\n      });\n    };\n\n    request.onsuccess = event => {\n      let curVer = event.target.result.version;\n\n      if (curVer === dbVersion) {\n        resolve('success');\n      }\n    };\n  });\n}\n\nfunction updgradeDB(db, name) {\n  return new Promise((resolve, reject) => {\n    let store = db.createObjectStore(name, {\n      keyPath: 'id',\n      autoIncrement: true\n    });\n\n    store.onerror = () => {\n      console.error(\"store not created, error: \", store.error);\n      reject(\"Failed to open database\");\n    };\n\n    store.onsuccess = () => {\n      resolve(`Store ${name} created successfully`);\n    };\n  });\n}\n\nfunction getAll(dbName, dbVersion, objectStoreName) {\n  return new Promise((resolve, reject) => {\n    let request = window.indexedDB.open(dbName, dbVersion);\n\n    request.onsuccess = event => {\n      let db = request.result;\n      let transaction = db.transaction(objectStoreName, 'readwrite');\n      let store = transaction.objectStore(objectStoreName);\n      let objStoreReq = store.getAll();\n\n      objStoreReq.onsuccess = event => {\n        resolve(event.target.result);\n      };\n\n      objStoreReq.onerror = event => {\n        reject(\"Unable to get data\");\n      };\n\n      transaction.onerror = event => {\n        reject(\"Unable to get data\");\n      };\n    };\n\n    request.onerror = event => {\n      reject(\"Unable to get data\");\n    };\n  });\n}\n\nfunction getOne(dbName, dbVersion, objectStoreName, id) {\n  return new Promise((resolve, reject) => {\n    let request = window.indexedDB.open(dbName, dbVersion);\n\n    request.onsuccess = event => {\n      let db = request.result;\n      let transaction = db.transaction(objectStoreName, 'readwrite');\n      let store = transaction.objectStore(objectStoreName);\n      let objStoreReq = store.get(id);\n\n      objStoreReq.onsuccess = event => {\n        resolve(event.target.result);\n      };\n\n      objStoreReq.onerror = event => {\n        reject(\"Unable to get data\");\n      };\n\n      transaction.onerror = event => {\n        reject(\"Unable to get data\");\n      };\n    };\n\n    request.onerror = event => {\n      reject(\"Unable to get data\");\n    };\n  });\n}\n\nfunction addOrUpdateMany(dbName, dbVersion, objectStoreName, items) {\n  return new Promise((resolve, reject) => {\n    let request = window.indexedDB.open(dbName, dbVersion);\n\n    request.onsuccess = event => {\n      let db = request.result;\n      let transaction = db.transaction(objectStoreName, 'readwrite');\n      let store = transaction.objectStore(objectStoreName);\n      let objStoreReq;\n      items.forEach(item => {\n        objStoreReq = store.put(item);\n\n        objStoreReq.onerror = function (event) {\n          reject(\"Error storing item \" + item);\n        };\n      });\n\n      transaction.oncomplete = function (event) {\n        resolve(\"Data saved successfully\");\n      };\n\n      transaction.onerror = event => {\n        reject(\"Failed to save data\");\n      };\n    };\n\n    request.onerror = event => {\n      reject(\"Failed to save data\");\n    };\n  });\n}\n\nfunction addOrUpdateOne(dbName, dbVersion, objectStoreName, item) {\n  return new Promise((resolve, reject) => {\n    let request = window.indexedDB.open(dbName, dbVersion);\n\n    request.onsuccess = event => {\n      let db = request.result;\n      let transaction = db.transaction(objectStoreName, 'readwrite');\n      let store = transaction.objectStore(objectStoreName);\n      store.put(item);\n\n      transaction.oncomplete = event => {\n        resolve(\"Data saved successfully\");\n      };\n\n      transaction.onerror = event => {\n        reject(\"Failed to save data\");\n      };\n    };\n\n    request.onerror = event => {\n      reject(\"Failed to save data\");\n    };\n  });\n}\n\nfunction deleteOne(dbName, dbVersion, objectStoreName, id) {\n  return new Promise((resolve, reject) => {\n    let request = window.indexedDB.open(dbName, dbVersion);\n\n    request.onsuccess = event => {\n      let db = request.result;\n      let transaction = db.transaction(objectStoreName, 'readwrite');\n      let store = transaction.objectStore(objectStoreName);\n      let objStoreReq = store.delete(id);\n\n      objStoreReq.onsuccess = event => {\n        resolve(\"Item was deleted\");\n      };\n\n      objStoreReq.onerror = event => {\n        reject(\"Unable to delete entry\");\n      };\n\n      transaction.onerror = event => {\n        reject(\"Unable to delete entry\");\n      };\n    };\n\n    request.onerror = event => {\n      reject(\"Unable to delete entry\");\n    };\n  });\n}\n\nfunction deleteAll(dbName, dbVersion, objectStoreNames) {\n  return new Promise((resolve, reject) => {\n    let request = window.indexedDB.open(dbName, dbVersion);\n\n    request.onsuccess = event => {\n      let db = request.result;\n      objectStoreNames.forEach(name => {\n        let transaction = db.transaction(name, 'readwrite');\n        let store = transaction.objectStore(name);\n        let objStoreReq = store.clear();\n\n        objStoreReq.onsuccess = event => {\n          let message = \"Data has been successfully deleted\";\n          resolve(message);\n        };\n\n        objStoreReq.onerror = event => {\n          reject(\"Unable to delete data\");\n        };\n\n        transaction.onerror = event => {\n          reject(\"Unable to delete data\");\n        };\n      });\n    };\n\n    request.onerror = event => {\n      reject(\"Unable to delete data\");\n    };\n  });\n}\n\nlet iDB = {\n  init: initIDB,\n  getAll: getAll,\n  getOne: getOne,\n  addOrUpdateMany: addOrUpdateMany,\n  addOrUpdateOne: addOrUpdateOne,\n  deleteOne: deleteOne,\n  deleteAll: deleteAll\n};\nexport default iDB;","map":{"version":3,"sources":["C:/Users/ceg94/Development/10for20challenge/src/data/indexedDb.ts"],"names":["initIDB","dbName","dbVersion","objectStoreNames","Promise","resolve","reject","window","console","warn","request","indexedDB","open","onerror","event","error","onupgradeneeded","db","target","result","successCount","forEach","name","index","updgradeDB","then","catch","message","length","onsuccess","curVer","version","store","createObjectStore","keyPath","autoIncrement","getAll","objectStoreName","transaction","objectStore","objStoreReq","getOne","id","get","addOrUpdateMany","items","item","put","oncomplete","addOrUpdateOne","deleteOne","delete","deleteAll","clear","iDB","init"],"mappings":"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","sourcesContent":["\r\nfunction initIDB(dbName:string, dbVersion:number, objectStoreNames:string[]){\r\n  return new Promise((resolve,reject)=> {\r\n    // dbName will be the DB name, storeName will be the store name.\r\n    if(!('indexedDB' in window)){\r\n      console.warn(\"This browser doesn't support IndexedDB\");\r\n      return;\r\n    }\r\n    // create or open IndexedDB\r\n    let request = window.indexedDB.open(dbName, dbVersion);\r\n\r\n    // handle errors\r\n    request.onerror = function(event:any){\r\n      console.error(\"IndexedDB Error: \", request.error);\r\n      reject(\"Failed to open database\");\r\n    };\r\n\r\n    // handle db upgrades\r\n    request.onupgradeneeded = function(event:any) {\r\n      // save the IDBDatabase interface\r\n      let db = event.target.result;\r\n      let successCount = 0;\r\n      // Create an objectStore for the database\r\n      objectStoreNames.forEach((name, index)=>{\r\n        updgradeDB(db, name).then(()=>{\r\n          successCount++;\r\n        }).catch((message)=>{\r\n          console.error(message);\r\n        });\r\n        if(index+1 === objectStoreNames.length){\r\n          resolve(\"Database access granted\");\r\n        } else {\r\n          reject(\"Database access rejected\");\r\n        }\r\n      });\r\n    };\r\n\r\n    request.onsuccess = (event:any) => {\r\n      let curVer = event.target.result.version;\r\n      if(curVer === dbVersion){\r\n        resolve('success');\r\n      }\r\n    };\r\n  });\r\n}\r\n\r\nfunction updgradeDB(db:any, name:string){\r\n  return new Promise((resolve, reject)=>{\r\n    let store = db.createObjectStore(\r\n      name,\r\n      {keyPath:'id',autoIncrement:true}\r\n    );\r\n\r\n    store.onerror = () => {\r\n      console.error(\"store not created, error: \",store.error);\r\n      reject(\"Failed to open database\");\r\n    };\r\n    store.onsuccess = () =>{\r\n      resolve(`Store ${name} created successfully`);\r\n    }\r\n  });\r\n}\r\n\r\nfunction getAll(dbName:string, dbVersion:number, objectStoreName:string):Promise<object[]|string>{\r\n  return new Promise((resolve, reject)=>{\r\n    let request = window.indexedDB.open(dbName, dbVersion);\r\n\r\n    request.onsuccess = (event:any) => {\r\n      let db = request.result;\r\n      let transaction = db.transaction(objectStoreName, 'readwrite');\r\n\r\n      let store = transaction.objectStore(objectStoreName);\r\n      let objStoreReq = store.getAll();\r\n\r\n      objStoreReq.onsuccess = (event:any) => {\r\n        resolve(event.target.result);\r\n      };\r\n\r\n      objStoreReq.onerror = (event:any) => {\r\n        reject(\"Unable to get data\");\r\n      };\r\n\r\n      transaction.onerror = (event:any) => {\r\n        reject(\"Unable to get data\");\r\n      };\r\n    };\r\n\r\n    request.onerror = (event:any) => {\r\n      reject(\"Unable to get data\");\r\n    };\r\n  });\r\n}\r\n\r\nfunction getOne(dbName:string, dbVersion:number, objectStoreName:string, id:any){\r\n  return new Promise((resolve, reject)=>{\r\n    let request = window.indexedDB.open(dbName, dbVersion);\r\n\r\n    request.onsuccess = (event:any) => {\r\n      let db = request.result;\r\n      let transaction = db.transaction(objectStoreName, 'readwrite');\r\n\r\n      let store = transaction.objectStore(objectStoreName);\r\n      let objStoreReq = store.get(id);\r\n\r\n      objStoreReq.onsuccess = (event:any) => {\r\n        resolve(event.target.result);\r\n      };\r\n\r\n      objStoreReq.onerror = (event:any) => {\r\n        reject(\"Unable to get data\");\r\n      };\r\n\r\n      transaction.onerror = (event:any) => {\r\n        reject(\"Unable to get data\");\r\n      };\r\n    };\r\n\r\n    request.onerror = (event:any) => {\r\n      reject(\"Unable to get data\");\r\n    };\r\n  });\r\n}\r\n\r\nfunction addOrUpdateMany(dbName:string, dbVersion:number, objectStoreName:string, items:any[]) {\r\n  return new Promise((resolve,reject) => {\r\n    let request = window.indexedDB.open(dbName, dbVersion);\r\n\r\n    request.onsuccess = (event:any) => {\r\n      let db = request.result;\r\n      let transaction = db.transaction(objectStoreName, 'readwrite');\r\n      let store = transaction.objectStore(objectStoreName);\r\n      let objStoreReq;\r\n      items.forEach((item:any) => {\r\n        objStoreReq = store.put(item);\r\n        \r\n        objStoreReq.onerror = function(event) {\r\n          reject(\"Error storing item \"+item);\r\n        };\r\n      });\r\n\r\n      transaction.oncomplete = function(event) {\r\n        resolve(\"Data saved successfully\");\r\n      };\r\n\r\n      transaction.onerror = (event:any) => {\r\n        reject(\"Failed to save data\");\r\n      };\r\n    };\r\n\r\n    request.onerror = (event:any) => {\r\n      reject(\"Failed to save data\");\r\n    };\r\n  });\r\n}\r\n\r\nfunction addOrUpdateOne(dbName:string, dbVersion:number, objectStoreName:string, item:any){\r\n  return new Promise((resolve,reject) => {\r\n    let request = window.indexedDB.open(dbName, dbVersion);\r\n\r\n    request.onsuccess = (event:any) => {\r\n      let db = request.result;\r\n      let transaction = db.transaction(objectStoreName, 'readwrite');\r\n      let store = transaction.objectStore(objectStoreName);\r\n      store.put(item);\r\n\r\n      transaction.oncomplete = (event:any) => {\r\n        resolve(\"Data saved successfully\");\r\n      };\r\n\r\n      transaction.onerror = (event:any) => {\r\n        reject(\"Failed to save data\");\r\n      };\r\n    };\r\n\r\n    request.onerror = (event:any) => {\r\n      reject(\"Failed to save data\");\r\n    };\r\n  });\r\n}\r\n\r\nfunction deleteOne(dbName:string, dbVersion:number, objectStoreName:string, id:any){\r\n  return new Promise((resolve,reject)=>{\r\n    let request = window.indexedDB.open(dbName, dbVersion);\r\n\r\n    request.onsuccess = (event:any) => {\r\n      let db = request.result;\r\n      let transaction = db.transaction(objectStoreName, 'readwrite');\r\n      let store = transaction.objectStore(objectStoreName);\r\n      let objStoreReq = store.delete(id);\r\n\r\n      objStoreReq.onsuccess = (event:any) => {\r\n        resolve(\"Item was deleted\");\r\n      };\r\n\r\n      objStoreReq.onerror = (event:any) => {\r\n        reject(\"Unable to delete entry\");\r\n      };\r\n\r\n      transaction.onerror = (event:any) => {\r\n        reject(\"Unable to delete entry\");\r\n      };\r\n    };\r\n\r\n    request.onerror = (event:any) => {\r\n      reject(\"Unable to delete entry\");\r\n    };\r\n  });\r\n}\r\n\r\nfunction deleteAll(dbName:string, dbVersion:number, objectStoreNames:string[]){\r\n  return new Promise((resolve,reject)=>{\r\n    let request = window.indexedDB.open(dbName, dbVersion);\r\n\r\n    request.onsuccess = (event:any) => {\r\n      let db = request.result;\r\n\r\n      objectStoreNames.forEach((name)=>{\r\n        let transaction = db.transaction(name, 'readwrite');\r\n        let store = transaction.objectStore(name);\r\n        let objStoreReq = store.clear();\r\n  \r\n        objStoreReq.onsuccess = (event:any) => {\r\n          let message = \"Data has been successfully deleted\";\r\n          resolve(message);\r\n        };\r\n  \r\n        objStoreReq.onerror = (event:any) => {\r\n          reject(\"Unable to delete data\");\r\n        };\r\n\r\n        transaction.onerror = (event:any) => {\r\n          reject(\"Unable to delete data\");\r\n        };\r\n      });\r\n    };\r\n\r\n    request.onerror = (event:any) => {\r\n      reject(\"Unable to delete data\");\r\n    };\r\n  });\r\n}\r\nlet iDB = {\r\n  init: initIDB,\r\n  getAll: getAll,\r\n  getOne: getOne,\r\n  addOrUpdateMany: addOrUpdateMany, \r\n  addOrUpdateOne: addOrUpdateOne, \r\n  deleteOne: deleteOne, \r\n  deleteAll: deleteAll\r\n};\r\nexport default iDB;"]},"metadata":{},"sourceType":"module"}